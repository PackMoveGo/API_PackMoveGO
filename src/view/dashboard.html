<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PackMoveGO - Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.5rem;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.3s ease;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .welcome-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .welcome-card h2 {
            color: #333;
            margin-bottom: 1rem;
        }
        
        .welcome-card p {
            color: #666;
            line-height: 1.6;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .stat-card p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .api-section {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .api-section h3 {
            color: #333;
            margin-bottom: 1rem;
        }
        
        .api-endpoints {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .endpoint {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
        
        .endpoint h4 {
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .endpoint p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .endpoint .method {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 0.8rem;
            margin-right: 0.5rem;
        }
        
        .session-info {
            background: #e8f4fd;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
        }
        
        .session-info h4 {
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .session-info p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }
        
        .ssh-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .ssh-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .ssh-card h4 {
            color: #333;
            margin-bottom: 1rem;
        }
        
        .ssh-card p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .ssh-card code {
            background: #e9ecef;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>PackMoveGO Admin Dashboard</h1>
        <a href="#" class="logout-btn" onclick="logout()">Logout</a>
    </div>
    
    <div class="container">
        <div class="welcome-card">
            <h2>Welcome to PackMoveGO Admin Dashboard</h2>
            <p>You have successfully authenticated and have access to the admin panel. Your session will remain active for 10 minutes.</p>
        </div>
        
        <div class="session-info">
            <h4>Session Information</h4>
            <p><strong>IP Address:</strong> <span id="ipAddress">Loading...</span></p>
            <p><strong>Authentication Status:</strong> <span id="authStatus">Loading...</span></p>
            <p><strong>Session Expires:</strong> <span id="sessionExpires">Loading...</span></p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="uptime">--</h3>
                <p>Server Uptime (seconds)</p>
            </div>
            <div class="stat-card">
                <h3 id="requests">--</h3>
                <p>Total Requests</p>
            </div>
            <div class="stat-card">
                <h3 id="errors">--</h3>
                <p>Error Rate</p>
            </div>
            <div class="stat-card">
                <h3 id="responseTime">--</h3>
                <p>Avg Response Time (ms)</p>
            </div>
        </div>
        
        <div class="api-section">
            <h3>Available API Endpoints</h3>
            <div class="api-endpoints">
                <div class="endpoint">
                    <h4><span class="method">GET</span>/api/health</h4>
                    <p>Server health check and status information</p>
                </div>
                <div class="endpoint">
                    <h4><span class="method">GET</span>/api/data/:name</h4>
                    <p>Retrieve data by name (blog, about, nav, etc.)</p>
                </div>
                <div class="endpoint">
                    <h4><span class="method">POST</span>/api/auth/login</h4>
                    <p>Authenticate with admin password</p>
                </div>
                <div class="endpoint">
                    <h4><span class="method">POST</span>/api/auth/logout</h4>
                    <p>Logout and clear session</p>
                </div>
                <div class="endpoint">
                    <h4><span class="method">GET</span>/api/auth/status</h4>
                    <p>Check authentication status</p>
                </div>
                <div class="endpoint">
                    <h4><span class="method">GET</span>/api/auth/protected</h4>
                    <p>Protected resource example</p>
                </div>
                <div class="endpoint">
                    <h4><span class="method">GET</span>/api/ssh/status</h4>
                    <p>SSH server status and active sessions</p>
                </div>
                <div class="endpoint">
                    <h4><span class="method">GET</span>/api/ssh/config</h4>
                    <p>SSH server configuration</p>
                </div>
                <div class="endpoint">
                    <h4><span class="method">GET</span>/api/ssh/instructions</h4>
                    <p>SSH connection instructions</p>
                </div>
            </div>
        </div>
        
        <div class="api-section">
            <h3>SSH Access</h3>
            <div class="ssh-info">
                <div class="ssh-card">
                    <h4>üîê SSH Connection</h4>
                    <p><strong>Command:</strong> <code id="sshCommand">Loading...</code></p>
                    <p><strong>Username:</strong> admin</p>
                    <p><strong>Password:</strong> <span id="sshPassword">Loading...</span></p>
                    <p><strong>Port:</strong> <span id="sshPort">Loading...</span></p>
                    <p><strong>Session Timeout:</strong> 10 minutes</p>
                </div>
                <div class="ssh-card">
                    <h4>üìä SSH Status</h4>
                    <p><strong>Active Connections:</strong> <span id="sshConnections">Loading...</span></p>
                    <p><strong>Allowed IPs:</strong> <span id="sshAllowedIPs">Loading...</span></p>
                    <p><strong>Frontend IP:</strong> <span id="sshFrontendIP">Loading...</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Check authentication status
                const authResponse = await fetch('/api/auth/status', {
                    credentials: 'include'
                });
                
                if (!authResponse.ok) {
                    window.location.href = '/login';
                    return;
                }
                
                const authData = await authResponse.json();
                
                if (!authData.success || !authData.authenticated) {
                    window.location.href = '/login';
                    return;
                }
                
                // Update session info
                document.getElementById('ipAddress').textContent = authData.ip || 'Unknown';
                document.getElementById('authStatus').textContent = authData.authenticated ? 'Authenticated' : 'Not Authenticated';
                
                // Calculate session expiry (10 minutes from now)
                const now = new Date();
                const expires = new Date(now.getTime() + 10 * 60 * 1000);
                document.getElementById('sessionExpires').textContent = expires.toLocaleString();
                
                // Load server metrics
                const healthResponse = await fetch('/api/health', {
                    credentials: 'include'
                });
                
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    document.getElementById('uptime').textContent = healthData.uptime || '--';
                    
                                    if (healthData.requests) {
                    document.getElementById('requests').textContent = healthData.requests.total || '--';
                    document.getElementById('errors').textContent = healthData.requests.errors || '--';
                    document.getElementById('responseTime').textContent = healthData.requests.avgResponseTime || '--';
                }
                
                // Load SSH data
                try {
                    const sshResponse = await fetch('/api/ssh/config', {
                        credentials: 'include'
                    });
                    
                    if (sshResponse.ok) {
                        const sshData = await sshResponse.json();
                        if (sshData.success) {
                            document.getElementById('sshCommand').textContent = `ssh -p ${sshData.config.port} admin@${sshData.config.host}`;
                            document.getElementById('sshPassword').textContent = 'packmovego2024';
                            document.getElementById('sshPort').textContent = sshData.config.port;
                            document.getElementById('sshAllowedIPs').textContent = sshData.config.allowedIPs.join(', ');
                            document.getElementById('sshFrontendIP').textContent = sshData.config.frontendIP;
                        }
                    }
                    
                    const sshStatusResponse = await fetch('/api/ssh/status', {
                        credentials: 'include'
                    });
                    
                    if (sshStatusResponse.ok) {
                        const sshStatusData = await sshStatusResponse.json();
                        if (sshStatusData.success) {
                            document.getElementById('sshConnections').textContent = sshStatusData.ssh.activeConnections;
                        }
                    }
                } catch (error) {
                    console.error('Error loading SSH data:', error);
                }
                }
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                window.location.href = '/login';
            }
        }
        
        // Logout function
        async function logout() {
            try {
                await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include'
                });
                
                window.location.href = '/login';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/login';
            }
        }
        
        // Auto-refresh session info every 30 seconds
        setInterval(loadDashboardData, 30000);
        
        // Load data on page load
        loadDashboardData();
        
        // Check session every minute
        setInterval(async () => {
            try {
                const response = await fetch('/api/auth/status', {
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (!data.success || !data.authenticated) {
                    alert('Session expired. Please login again.');
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Session check error:', error);
            }
        }, 60000);
    </script>
</body>
</html> 